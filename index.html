<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mathify ðŸ“˜ Step-by-Step v6</title>
<style>
  body{font-family:system-ui,Arial;max-width:720px;margin:0 auto;padding:24px;background:#f6f7fb}
  h1{margin:0 0 8px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px}
  input{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:10px;margin:8px 0}
  button{padding:10px 14px;border:0;border-radius:10px;background:#1f6feb;color:#fff;cursor:pointer}
  pre{white-space:pre-wrap;word-wrap:break-word}
  .muted{color:#6b7280}
</style>

<script src="https://cdn.jsdelivr.net/npm/mathjs@11/lib/browser/math.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/nerdamer.core.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/Solve.js"></script>
</head>
<body>
  <h1>Mathify ðŸ“˜ Step-by-Step v6</h1>
  <p class="muted">Now shows steps for SHS + University math</p>

  <div class="card">
    <input id="q" placeholder="Example: 2y + 10 = 4 or 10Ã·2">
    <button onclick="compute()">Solve</button>
    <pre id="out"></pre>
  </div>

<script>
function sanitize(expr){
  let e = String(expr||'').trim();
  e = e.replace(/[Ã·:]/g,'/').replace(/â€“|âˆ’/g,'-');
  e = e.replace(/(\d|\))\s*[xXÃ—â‹…Â·â€¢]\s*(\d|\()/g,'$1*$2');
  e = e.replace(/(\d)\s*([a-zA-Z])/g,'$1*$2')
       .replace(/([a-zA-Z])\s*(\d)/g,'$1*$2')
       .replace(/(\d)\s*\(/g,'$1*(')
       .replace(/\)\s*\(/g,')*(');
  return e;
}

function compute(){
  const raw = document.getElementById('q').value || '';
  const expr = sanitize(raw);
  const out = document.getElementById('out');
  let steps = `Expression: ${expr}\n\n`;

  try {
    if (expr.includes('=')) {
      // ---- EQUATION ----
      const [L,R] = expr.split('=');
      const variable = (L+R).match(/[a-zA-Z]/)?.[0] || 'x';
      const poly = `${L}-(${R})`;

      // Try linear first
      const sol = nerdamer.solve(poly, variable);
      const result = sol.toString();

      // Try to show simple linear steps
      if (/^[\d\+\-\*\/]*[a-zA-Z]/.test(L)) {
        // Example: 2y + 10 = 4
        const left = L.match(/([0-9]*)\*?[a-zA-Z]/);
        if (left) {
          const coeff = parseFloat(left[1] || 1);
          const rightNum = math.evaluate(R) - (math.evaluate(L.replace(/[0-9]*\*?[a-zA-Z]/,'')) || 0);
          steps += `Step 1: Move constants to right side â†’ ${coeff}${variable} = ${rightNum}\n`;
          steps += `Step 2: Divide both sides by ${coeff} â†’ ${variable} = ${rightNum/coeff}\n`;
        }
      }
      steps += `Final Answer: ${variable} = ${result}`;
      out.textContent = steps;
      return;
    }

    // ---- SIMPLE ARITHMETIC ----
    const val = math.evaluate(expr);
    steps += `Step 1: Evaluate â†’ ${val}\nFinal Answer: ${val}`;
    out.textContent = steps;
  } catch (err) {
    out.textContent = `Error: ${err.message}`;
  }
}
</script>
</body>
</html>
