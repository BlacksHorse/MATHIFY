<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mathify üìò Step-by-Step v15 (Topics)</title>
<style>
  :root{--blue:#1f6feb;--green:#059669;--muted:#6b7280;}
  body{font-family:system-ui,Arial;max-width:780px;margin:0 auto;padding:24px;background:#f6f7fb}
  h1{margin:0 0 8px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px;margin-top:10px}
  select,input{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:10px;margin:6px 0}
  button{padding:10px 14px;border:0;border-radius:10px;background:var(--blue);color:#fff;cursor:pointer}
  .muted{color:var(--muted)}
  .tag{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #d1d5db;background:#fff;margin:4px 6px 0 0;cursor:pointer}
  .tag:hover{border-color:#c0c4cc}
  .step-box{background:#e8f0fe;padding:10px 12px;margin:8px 0;border-left:6px solid var(--blue);border-radius:10px}
  .answer-box{background:#d1fae5;padding:10px 12px;margin-top:10px;border-left:6px solid var(--green);border-radius:10px;font-weight:bold}
  .warn{background:#fff7ed;border-left-color:#ea580c}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#eef2ff;border:1px solid #dbe1ff}
  .hide{display:none}
  code{background:#eef2ff;padding:0 4px;border-radius:6px}
</style>
<script src="https://unpkg.com/mathjs@11.8.0/lib/browser/math.js"></script>
</head>
<body>
  <h1>Mathify üìò Step-by-Step v15</h1>
  <p class="muted">Choose a topic (SHS or University), tap an example, then solve with clear steps.</p>

  <!-- Topic + extra options -->
  <div class="card">
    <div class="row">
      <div style="flex:1 1 320px">
        <label class="muted">Topic</label>
        <select id="topic"></select>
      </div>
      <div id="degWrap" class="pill hide">
        <input type="checkbox" id="useDeg" />
        <label for="useDeg">Trigonometry: use degrees (e.g., sin(30¬∞))</label>
      </div>
    </div>
    <div id="topicDesc" class="muted" style="margin-top:6px"></div>
  </div>

  <!-- Examples -->
  <div class="card">
    <div class="muted">Examples</div>
    <div id="examples" class="row"></div>
  </div>

  <!-- Solver -->
  <div class="card">
    <input id="q" placeholder="Type a problem, or tap an example above" />
    <div class="row">
      <button onclick="compute()">Solve</button>
      <button style="background:#475569" onclick="clearOut()">Clear</button>
      <button style="background:#0f766e" onclick="copySteps()">Copy steps</button>
    </div>
    <div id="out" style="margin-top:10px"></div>
  </div>

<script>
/* ----------------------- Topic catalog ----------------------- */
const TOPICS = {
  "SHS": {
    "Basic Arithmetic": {
      desc: "Add, subtract, multiply, divide; fractions, powers.",
      ex: ["10√∑2", "2√ó3", "5^2", "3(4+2)"]
    },
    "Linear Equations": {
      desc: "Solve for x, y in equations of the form ax + b = c.",
      ex: ["2y+10=4", "3x-9=0", "2(y+2)=12"]
    },
    "Quadratics": {
      desc: "Equations ax¬≤ + bx + c = 0 with formula steps.",
      ex: ["x^2+3x+2=0", "2x^2+3x+1=0", "x^2+4x+4=0"]
    },
    "Algebraic Expressions": {
      desc: "Expand & simplify algebraic forms.",
      ex: ["(x+2)(x+3)", "2(x+1)^2", "3x(x-4)"]
    },
    "Simultaneous Equations": {
      desc: "Systems of linear equations (coming soon).",
      ex: ["2x+y=7 & x-y=1"]
    },
    "Functions": {
      desc: "Evaluate/simplify functions.",
      ex: ["f(x)=x^2+3x+1; f(2)"]
    },
    "Trigonometry": {
      desc: "Sine, cosine, tangent; set degrees option if needed.",
      ex: ["sin(30)", "cos(60)", "tan(45)"]
    },
    "Geometry & Mensuration": {
      desc: "Areas, perimeters, volumes via formulas.",
      ex: ["pi*5^2", "2*pi*7", "(1/3)*pi*3^2*10"]
    },
    "Sequences & Series": {
      desc: "Arithmetic/Geometric terms & sums.",
      ex: ["a1=3,d=2; a5=a1+(5-1)d", "S5=(5/2)(2*3+(5-1)2)"]
    },
    "Probability & Statistics": {
      desc: "Basic probability & averages.",
      ex: ["(3 choose 2)", "mean(2,4,6,8)"]
    }
  },
  "University": {
    "Calculus ‚Äì Limits": {
      desc: "Basic limit evaluation.",
      ex: ["limit((x^2-1)/(x-1), x, 1)"]
    },
    "Calculus ‚Äì Differentiation": {
      desc: "Differentiate functions symbolically.",
      ex: ["derivative(x^3+2x, x)"]
    },
    "Calculus ‚Äì Integration": {
      desc: "Indefinite/definite integrals.",
      ex: ["integral(2x, x)", "integral(sin(x), x, 0, pi)"]
    },
    "Linear Algebra": {
      desc: "Vectors, matrices (basic eval).",
      ex: ["[[1,2],[3,4]] * [[1,0],[0,1]]", "det([[2,1],[5,3]])"]
    },
    "Complex Numbers": {
      desc: "Operations with i = ‚àö(-1).",
      ex: ["(2+3i)*(1-i)", "abs(3+4i)"]
    },
    "Differential Equations": {
      desc: "Symbolic ODEs (basic forms).",
      ex: ["derivative(y,x)=y"]
    },
    "Probability & Statistics": {
      desc: "Combinatorics & stats.",
      ex: ["combinations(5,2)", "std([2,4,6,8])"]
    },
    "Numerical Methods": {
      desc: "Evaluate numeric expressions.",
      ex: ["solve? (coming soon)"]
    }
  }
};

/* ----------------------- UI wiring ----------------------- */
const topicSelect = document.getElementById('topic');
const topicDesc   = document.getElementById('topicDesc');
const examplesBox = document.getElementById('examples');
const degWrap     = document.getElementById('degWrap');
const useDeg      = document.getElementById('useDeg');

(function buildTopics(){
  for(const section of Object.keys(TOPICS)){
    const og = document.createElement('optgroup');
    og.label = section;
    for(const t of Object.keys(TOPICS[section])){
      const opt = document.createElement('option');
      opt.value = `${section}::${t}`;
      opt.textContent = t;
      og.appendChild(opt);
    }
    topicSelect.appendChild(og);
  }
  topicSelect.value = "SHS::Linear Equations";
  onTopicChange();
})();
topicSelect.addEventListener('change', onTopicChange);

function onTopicChange(){
  const [section, t] = topicSelect.value.split('::');
  const cfg = TOPICS[section][t];
  topicDesc.textContent = cfg.desc;
  examplesBox.innerHTML = '';
  cfg.ex.forEach((ex)=>{
    const tag = document.createElement('div');
    tag.className = 'tag';
    tag.textContent = ex;
    tag.onclick = () => { document.getElementById('q').value = ex; };
    examplesBox.appendChild(tag);
  });
  // show degrees toggle only for Trigonometry
  if (t.toLowerCase().includes('trigonometry')) {
    degWrap.classList.remove('hide');
  } else {
    degWrap.classList.add('hide');
    useDeg.checked = false;
  }
}

/* --------------------- Solver (v14 core) --------------------- */
function sanitize(expr){
  let e = String(expr||'').trim();
  e = e.replace(/[√∑:]/g,'/').replace(/‚Äì|‚àí/g,'-');
  e = e.replace(/(\d|\))\s*[xX√ó‚ãÖ¬∑‚Ä¢]\s*(\d|\()/g,'$1*$2');
  e = e.replace(/(\d)\s*([a-zA-Z])/g,'$1*$2')
       .replace(/([a-zA-Z])\s*(\d)/g,'$1*$2')
       .replace(/(\d)\s*\(/g,'$1*(')
       .replace(/\)\s*\(/g,')*(');
  return e;
}
function add(out, html){ out.innerHTML += html; }
function fmt(n){ return Number.isFinite(n) ? (Math.round(n*1e10)/1e10).toString() : String(n); }
function num(s){ if(s===''||s==='+')return 1; if(s==='-')return -1; return parseFloat(s); }

/* Degrees helper for trig if enabled */
function applyDegreesIfNeeded(expr){
  if (!useDeg.checked) return expr;
  // convert sin(30) -> sin(30 deg), etc. (only top-level simple forms)
  return expr.replace(/\b(sin|cos|tan|asin|acos|atan)\s*\(([^()]+)\)/g, (_,fn,arg)=>{
    return `${fn}(${arg} deg)`;
  });
}

function extractQuadraticCoeffs(poly, variable){
  const p = poly.replace(/\s+/g,'').replace(/\*\*/g,'^');
  let a=0,b=0,c=0;
  const ax2=new RegExp(`([+\\-]?\\d*\\.?\\d*)\\*?${variable}\\^2`);
  const bx =new RegExp(`([+\\-]?\\d*\\.?\\d*)\\*?${variable}(?!\\^)`);
  const ma=p.match(ax2); if(ma) a=num(ma[1]);
  const mb=p.match(bx);  if(mb) b=num(mb[1]);
  let rest=p.replace(ax2,'').replace(bx,'') || '0';
  c = Number(math.evaluate(rest));
  return {a,b,c};
}
function solveLinear(e, variable, out){
  const clean=e.replace(/\s+/g,'');
  const rx=new RegExp(`([+\\-]?\\d*\\.?\\d*)\\*?${variable}([+\\-].+)?$`);
  const m=clean.match(rx);
  if(!m){ add(out, `<div class='answer-box warn'>Could not read a linear form in ${variable}.</div>`); return; }
  const a=num(m[1]), b=m[2]?Number(math.evaluate(m[2])):0;
  add(out, `<div class='step-box'>Step 3Ô∏è‚É£ Subtract <code>${fmt(b)}</code> from both sides ‚Üí <code>${fmt(a)}${variable} = ${fmt(-b)}</code></div>`);
  add(out, `<div class='step-box'>Step 4Ô∏è‚É£ Divide both sides by <code>${fmt(a)}</code> ‚Üí <code>${variable} = ${fmt((-b)/a)}</code></div>`);
  add(out, `<div class='answer-box'>Final Answer: ${variable} = ${fmt((-b)/a)}</div>`);
}
function solveQuadratic(e, variable, out){
  const {a,b,c}=extractQuadraticCoeffs(e,variable);
  if (Math.abs(a) < 1e-12) { solveLinear(e,variable,out); return; }
  add(out, `<div class='step-box'>Step 3Ô∏è‚É£ Identify coefficients ‚Üí <code>a=${fmt(a)}, b=${fmt(b)}, c=${fmt(c)}</code></div>`);
  const D=b*b-4*a*c;
  add(out, `<div class='step-box'>Step 4Ô∏è‚É£ Compute discriminant ‚Üí <code>D = b¬≤ ‚àí 4ac = ${fmt(D)}</code></div>`);
  add(out, `<div class='step-box'>Step 5Ô∏è‚É£ Use quadratic formula ‚Üí <code>${variable} = (-b ¬± ‚àöD) / (2a)</code></div>`);
  if (D > 0){
    const r=Math.sqrt(D), x1=(-b+r)/(2*a), x2=(-b-r)/(2*a);
    add(out, `<div class='answer-box'>Roots: ${variable} = ${fmt(x1)},  ${variable} = ${fmt(x2)}</div>`);
  } else if (Math.abs(D) < 1e-12){
    const x=(-b)/(2*a);
    add(out, `<div class='answer-box'>Double root: ${variable} = ${fmt(x)}</div>`);
  } else {
    const r=Math.sqrt(-D), real=(-b)/(2*a), imag=r/(2*a);
    add(out, `<div class='answer-box'>Complex roots: ${variable} = ${fmt(real)} ¬± ${fmt(imag)}i</div>`);
  }
}

/* --------------------- Main compute --------------------- */
function compute(){
  clearOut(false);
  const raw = document.getElementById('q').value || '';
  let expr = sanitize(raw);
  expr = applyDegreesIfNeeded(expr);

  const out = document.getElementById('out');
  add(out, `<div class="step-box">Problem: <code>${expr}</code></div>`);

  if (typeof math === "undefined"){ add(out, `<div class='step-box warn'>‚ö†Ô∏è Math.js failed to load.</div>`); return; }

  try{
    if (expr.includes('=')){
      const [L,R] = expr.split('=');
      const variable = (L+R).match(/[a-zA-Z]/)?.[0] || 'x';

      let left  = math.simplify(math.expand(math.simplify(L))).toString();
      let right = math.simplify(math.expand(math.simplify(R))).toString();

      add(out, `<div class='step-box'>Step 1Ô∏è‚É£ Expand & simplify each side ‚Üí <code>${left} = ${right}</code></div>`);
      const equation = math.simplify(math.expand(`${left}-(${right})`)).toString();
      add(out, `<div class='step-box'>Step 2Ô∏è‚É£ Move all terms to one side ‚Üí <code>${equation} = 0</code></div>`);

      if (new RegExp(`${variable}\\^2`).test(equation)) solveQuadratic(equation,variable,out);
      else solveLinear(equation,variable,out);
      return;
    }

    const simplified = math.simplify(expr).toString();
    const value = math.evaluate(expr);
    add(out, `<div class='step-box'>Step 1Ô∏è‚É£ Simplify ‚Üí <code>${simplified}</code></div>`);
    add(out, `<div class='answer-box'>Final Answer = ${fmt(value)}</div>`);
  }catch(err){
    add(out, `<div class='answer-box warn'>Error: ${err.message}</div>`);
  }
}

/* --------------------- Helpers --------------------- */
function clearOut(clearInput=true){
  if (clearInput) document.getElementById('q').value='';
  document.getElementById('out').innerHTML='';
}
async function copySteps(){
  const text = document.getElementById('out').innerText;
  try{
    await navigator.clipboard.writeText(text);
    alert('Steps copied to clipboard ‚úÖ');
  }catch{
    alert('Copy failed. Long-press to select and copy.');
  }
}
</script>
</body>
  </html>
