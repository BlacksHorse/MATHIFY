<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mathify üìò Step-by-Step v12 (Quadratic)</title>
<style>
  body{font-family:system-ui,Arial;max-width:720px;margin:0 auto;padding:24px;background:#f6f7fb}
  h1{margin:0 0 8px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px}
  input{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:10px;margin:8px 0}
  button{padding:10px 14px;border:0;border-radius:10px;background:#1f6feb;color:#fff;cursor:pointer}
  .step-box{background:#e8f0fe;padding:8px 10px;margin:6px 0;border-left:4px solid #1f6feb;border-radius:8px}
  .answer-box{background:#d1fae5;padding:8px 10px;margin-top:10px;border-left:4px solid #059669;border-radius:8px;font-weight:bold}
  .warn{background:#fff7ed;border-left-color:#ea580c}
  .muted{color:#6b7280}
</style>

<!-- math.js -->
<script src="https://unpkg.com/mathjs@11.8.0/lib/browser/math.js"></script>
</head>
<body>
  <h1>Mathify üìò Step-by-Step v12</h1>
  <p class="muted">Linear + Quadratic solver with student-friendly steps</p>

  <div class="card">
    <input id="q" placeholder="Try: 2y+10=4, 2(y+2)=12, 2x^2+3x+1=0">
    <button onclick="compute()">Solve</button>
    <div id="out"></div>
  </div>

<script>
function sanitize(expr){
  let e = String(expr||'').trim();
  e = e.replace(/[√∑:]/g,'/').replace(/‚Äì|‚àí/g,'-');
  e = e.replace(/(\d|\))\s*[xX√ó‚ãÖ¬∑‚Ä¢]\s*(\d|\()/g,'$1*$2');
  e = e.replace(/(\d)\s*([a-zA-Z])/g,'$1*$2')
       .replace(/([a-zA-Z])\s*(\d)/g,'$1*$2')
       .replace(/(\d)\s*\(/g,'$1*(')
       .replace(/\)\s*\(/g,')*(');
  return e;
}

function add(out, html){ out.innerHTML += html; }

// parse numeric string with implicit +/-1
function num(s){
  if (s === '' || s === '+' || s === undefined) return 1;
  if (s === '-') return -1;
  return parseFloat(s);
}

// Extract coefficients a,b,c from a simplified polynomial like "2*x^2+3*x+1"
function extractQuadraticCoeffs(poly, variable){
  const p = poly.replace(/\s+/g,'').replace(/\*\*/g,'^');
  let a=0, b=0, c=0;

  // a term
  const ax2 = new RegExp(`([+\\-]?\\d*\\.?\\d*)\\*?${variable}\\^2`);
  const ma = p.match(ax2);
  if (ma){ a = num(ma[1]); }

  // b term (var to the first power, but not ^2)
  const bx = new RegExp(`([+\\-]?\\d*\\.?\\d*)\\*?${variable}(?!\\^)`);
  const mb = p.match(bx);
  if (mb){ b = num(mb[1]); }

  // remove ax2 and bx to compute c
  let rest = p
    .replace(ax2,'')
    .replace(bx,'')
    .replace(/\+\+/g,'+')
    .replace(/\-\+/g,'-')
    .replace(/^\+/,'');
  // if nothing left, c=0; else evaluate remaining constants
  c = rest ? Number(math.evaluate(rest)) : 0;

  return {a,b,c};
}

function solveLinear(equationSimplified, variable, out){
  // equationSimplified is like "2*x+6"
  // find "a*var + b"
  let a=0, b=0;
  const match = equationSimplified.replace(/\s+/g,'').match(new RegExp(`([+\\-]?\\d*\\.?\\d*)\\*?${variable}([+\\-].+)?$`));
  if (match){
    a = num(match[1]);
    const rest = (match[2]||'');
    b = rest ? Number(math.evaluate(rest)) : 0;
  } else {
    add(out, `<div class='warn step-box'>Could not read a linear form in ${variable}.</div>`);
    return;
  }
  add(out, `<div class='step-box'>Step 3Ô∏è‚É£ Linear isolate ‚Üí ${a}${variable} + (${b}) = 0</div>`);
  const sol = -b/a;
  add(out, `<div class='answer-box'>Final Answer: ${variable} = ${sol}</div>`);
}

function solveQuadratic(equationSimplified, variable, out){
  // equationSimplified like "2*x^2+3*x+1"
  const {a,b,c} = extractQuadraticCoeffs(equationSimplified, variable);
  if (a === 0){ // actually linear
    solveLinear(equationSimplified, variable, out);
    return;
  }

  add(out, `<div class='step-box'>Step 3Ô∏è‚É£ Identify coefficients ‚Üí a=${a}, b=${b}, c=${c}</div>`);
  const D = b*b - 4*a*c;
  add(out, `<div class='step-box'>Step 4Ô∏è‚É£ Discriminant ‚Üí D = b¬≤ - 4ac = ${b}¬≤ - 4¬∑${a}¬∑${c} = ${D}</div>`);

  if (D > 0){
    const rootD = Math.sqrt(D);
    const x1 = (-b + rootD) / (2*a);
    const x2 = (-b - rootD) / (2*a);
    add(out, `<div class='step-box'>Step 5Ô∏è‚É£ Quadratic formula ‚Üí (-b ¬± ‚àöD) / (2a)</div>`);
    add(out, `<div class='answer-box'>Roots: ${variable} = ${x1}, ${variable} = ${x2}</div>`);
  } else if (D === 0){
    const x = (-b) / (2*a);
    add(out, `<div class='step-box'>Step 5Ô∏è‚É£ D = 0 ‚Üí double root</div>`);
    add(out, `<div class='answer-box'>Root: ${variable} = ${x}</div>`);
  } else {
    // Complex roots
    const rootD = Math.sqrt(-D);
    const real = (-b)/(2*a);
    const imag = rootD/(2*a);
    add(out, `<div class='step-box'>Step 5Ô∏è‚É£ D < 0 ‚Üí complex roots</div>`);
    add(out, `<div class='answer-box'>Roots: ${variable} = ${real} + ${imag}i, ${variable} = ${real} - ${imag}i</div>`);
  }
}

function compute(){
  const raw = document.getElementById('q').value || '';
  const expr = sanitize(raw);
  const out = document.getElementById('out');
  out.innerHTML = `<div class="step-box">Expression: ${expr}</div>`;

  if (typeof math === "undefined") {
    add(out, `<div class='step-box warn'>‚ö†Ô∏è Math.js failed to load. Check your internet.</div>`);
    return;
  }

  try {
    if (expr.includes('=')) {
      const [L,R] = expr.split('=');
      const variable = (L+R).match(/[a-zA-Z]/)?.[0] || 'x';

      const left = math.simplify(L).toString();
      const right = math.simplify(R).toString();
      const equation = `${left}-(${right})`;

      add(out, `<div class='step-box'>Step 1Ô∏è‚É£ Simplify both sides ‚Üí ${left} = ${right}</div>`);
      add(out, `<div class='step-box'>Step 2Ô∏è‚É£ Move all terms to one side ‚Üí ${equation} = 0</div>`);

      const simplified = math.simplify(equation).toString(); // like "2*x^2+3*x+1" or "2*x+6"
      // Decide: quadratic vs linear
      if (new RegExp(`${variable}\\^2`).test(simplified)){
        solveQuadratic(simplified, variable, out);
      } else {
        solveLinear(simplified, variable, out);
      }
      return;
    }

    // Pure arithmetic/expression
    const simplified = math.simplify(expr).toString();
    const val = math.evaluate(expr);
    add(out, `<div class='step-box'>Step 1Ô∏è‚É£ Simplify ‚Üí ${simplified}</div>`);
    add(out, `<div class='answer-box'>Final Answer = ${val}</div>`);

  } catch (err) {
    add(out, `<div class='answer-box warn'>Error: ${err.message}</div>`);
  }
}
</script>
</body>
</html>
